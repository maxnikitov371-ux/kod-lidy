# AGENTS.md - Код Лиды - строгий протокол работы

## Главная цель
Аккуратный рефакторинг проекта без изменения поведения.
Проект должен работать идентично до и после каждого шага.

---

# 1. Абсолютные запреты

- Нельзя менять тексты квеста и ответы.
- Нельзя менять формат localStorage.
- Нельзя менять публичные глобальные функции.
- Нельзя добавлять сборщики, npm, модули, webpack.
- Нельзя переводить проект на ES modules.
- Нельзя переименовывать классы, id, data-атрибуты без отдельного разрешения.
- Нельзя переносить ассеты и менять пути.
- Нельзя выполнять массовые форматирования.
- Нельзя создавать файлы вне утвержденной структуры.

---

# 2. Публичный API - запрещено ломать

Должно остаться рабочим:

- window.QUEST_DATA
- window.getTheme / setTheme
- window.getLanguage / setLanguage
- событие kod-lidy-theme-change
- событие kod-lidy-language-change
- window.renderParagraphText
- window.KodLidyMap.initMapPage
- логика прогресса в localStorage

Если что-либо из этого ломается - шаг считается невалидным.

---

# 3. Главный протокол работы

## 3.1 Маленькие шаги
Один шаг = одно логическое изменение.

## 3.2 No Broken State Protocol
Если после шага проект не работает:

- Немедленно остановиться.
- Либо полностью восстановить работоспособность.
- Либо откатить изменения текущего шага.
- Нельзя переходить к следующей задаче.

Фраза "починю потом" запрещена.

---

# 4. Commit discipline

- После каждого успешного шага пользователь делает 1 коммит.
- 1 коммит = 1 логическое изменение.
- В конце шага вывести Suggested commit message.
- Если шаг не работает - коммит запрещен.

---

# 5. Comment discipline

Каждый новый файл должен начинаться с русской шапки:

Пример:

// Назначение: ...
// Где используется: ...
// Зависимости: ...
// Публичный API: ...

В CSS:

/* SECTION: Header
   Назначение: стили шапки
   Где используется: все страницы
*/

Комментарии короткие и технические.
Использовать только дефис -, не использовать длинное тире.

---

# 6. Рефакторинг JavaScript

Правила:

- Сначала создать новый файл.
- Подключить его.
- Убедиться что все работает.
- Только потом удалить код из старого файла.

Нельзя:

- Менять порядок подключения скриптов.
- Менять глобальные имена.

---

# 7. Рефакторинг CSS

- themes.css не разбивать.
- Сначала подключить новый css файл.
- Только потом переносить стили.
- Внешний вид должен остаться идентичным.

---

# 8. Проверка после каждого шага

Обязательный чеклист:

- index.html работает
- map.html работает
- point.html принимает ответ
- progress.html показывает прогресс
- final.html блокируется до полного прохождения
- bonus.html открывается только после финала
- тема переключается корректно
- в консоли нет ошибок

---

# 9. Отчет после шага

В конце шага вывести:

- Измененные файлы
- Добавленные файлы
- Что перенесено
- Что не трогалось
- Чеклист ручной проверки
- Suggested commit message
